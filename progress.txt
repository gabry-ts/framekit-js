## Codebase Patterns
- Compat layer lives in `src/compat/` with helpers.ts (selectors, op), types.ts, and verbs.ts
- Use `DataFrame.fromColumns({})` for test fixtures
- Error types are in `src/errors.ts` — use `FrameKitError` with `ErrorCode` enum for general errors
- Tests use vitest with `describe/it/expect` pattern in `tests/unit/compat/`
- `desc()` helper already existed; `all()`, `not()`, `range()` added alongside it in helpers.ts
- `resolveSelector()` in helpers.ts resolves ColumnSelector against column name arrays
- New DataFrame methods: add to src/dataframe.ts, tests in tests/unit/dataframe-*.test.ts
- DataFrame internal: _columns (Map<string, Column>), _columnOrder (string[]); constructor calls addRef() on columns
- `reify()` delegates to `clone()` — both create deep copies of all columns via each Column's clone() method
---

## 2026-02-26 - US-005
- What was implemented: all(), not(), range() column selector helpers + resolveSelector() utility
- Files changed: src/compat/helpers.ts, tests/unit/compat/selectors.test.ts (new)
- **Learnings for future iterations:**
  - The compat types (AllSelector, NotSelector, RangeSelector, DescSpec, ColumnSelector) were already defined in types.ts
  - desc() was already implemented; only all/not/range needed to be added
  - resolveSelector takes a string[] of column names (not a DataFrame) for flexibility
  - range() handles reversed start/end by using Math.min/max on indices
---

## 2026-02-26 - US-006
- What was implemented: DataFrame.assign(otherDf) method that merges columns from another DataFrame
- Files changed: src/dataframe.ts, tests/unit/dataframe-assign.test.ts (new)
- **Learnings for future iterations:**
  - DataFrame constructor takes Map<string, Column<unknown>> and string[] columnOrder — access via _columns and _columnOrder
  - Column references use addRef() in constructor (CoW semantics) — sharing columns between DataFrames via assign is safe
  - Empty DataFrames (DataFrame.empty()) have 0 columns and 0 length — handle in shape checks
  - ShapeMismatchError is the right error for row count mismatches between DataFrames
---

## 2026-02-26 - US-007
- What was implemented: DataFrame.relocate(columns, { before | after }) method for reordering columns
- Files changed: src/dataframe.ts, tests/unit/dataframe-relocate.test.ts (new)
- **Learnings for future iterations:**
  - relocate works by filtering source columns out of _columnOrder, finding anchor index in remaining, then splicing
  - new DataFrame(new Map(this._columns), newOrder) reuses column references safely (CoW)
  - FrameKitError with ErrorCode.INVALID_OPERATION is used for logical errors (both before+after, neither before nor after)
  - ColumnNotFoundError for missing source or anchor columns
---

## 2026-02-26 - US-008
- What was implemented: DataFrame.reify() method that creates a deep, independent copy of a DataFrame
- Files changed: src/dataframe.ts, tests/unit/storage/cow-reify.test.ts (new)
- **Learnings for future iterations:**
  - DataFrame already has clone() which deep-copies all columns; reify() delegates to it
  - Each Column subclass implements clone() with type-specific deep copy (TypedArray copy, array spread, etc.)
  - BitArray null masks are also deep-copied via clone()
  - Tests cover: value equality, isolation (both directions), empty DF, after select/head (shared refs), null preservation
---
